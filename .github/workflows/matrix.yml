name: Generate Matrix Rain Banner

on:
  schedule:
    - cron: "0 */24 * * *"
  workflow_dispatch:
  push:
    branches:
      - main

jobs:
  matrix:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Create output directory
        run: mkdir -p dist/matrix

      - name: Generate Matrix Rain SVG
        run: |
          cat > dist/matrix/matrix.svg << 'EOF'
          <svg width="900" height="250" viewBox="0 0 900 250" xmlns="http://www.w3.org/2000/svg">
            <rect width="100%" height="100%" fill="#000"/>
            <style>
              text {
                font-family: monospace;
                font-size: 18px;
                fill: #00ff41;
                opacity: 0.8;
                animation: fall 1.8s linear infinite;
              }
              @keyframes fall {
                0%   { transform: translateY(-200px); opacity: 0; }
                40%  { opacity: 1; }
                100% { transform: translateY(260px); opacity: 0; }
              }
            </style>

            <!-- 40 colonnes de pluie Matrix -->
            <g>
              <!-- Génération automatique de 40 colonnes -->
              <!-- Chaque colonne a un délai différent pour l’effet pluie -->
              <!-- Le texte change à chaque exé pour un effet vivant -->
              <!-- Lignes générées dynamiquement -->
              <!-- Colonne par colonne -->
              <!-- 40 colonnes -->
              <!-- Animation -->
          EOF

          # Générer 40 colonnes de caractères aléatoires
          for i in $(seq 1 40); do
            x=$((i * 22))
            delay=$(awk -v min=0 -v max=2 'BEGIN{srand(); print min+rand()*(max-min)}')
            echo "<text x=\"$x\" y=\"0\" style=\"animation-delay: ${delay}s;\">" >> dist/matrix/matrix.svg
            tr -dc '01ABCDEFGHIJKLMNOPQRSTUVWXYZ' < /dev/urandom | head -c 40 >> dist/matrix/matrix.svg
            echo "</text>" >> dist/matrix/matrix.svg
          done

          # fermer le fichier SVG
          echo "</g></svg>" >> dist/matrix/matrix.svg
          EOF

      - name: Deploy Matrix Banner
        uses: crazy-max/ghaction-github-pages@v3
        with:
          target_branch: output
          build_dir: dist
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
